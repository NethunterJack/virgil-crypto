<!doctype html>
<html>
    <script type="text/javascript">
        function test_encryption() {
            var pwd = Module.VirgilByteArray.fromUTF8("password");
            var keys = new Module.VirgilKeyPair(pwd);
            var certId = Module.VirgilByteArray.fromUTF8("17648c7e-9ca3-4707-bdc6-a5c57b7a18fc");
            var data = Module.VirgilByteArray.fromUTF8("data to be encrypted");
            var cipher = new Module.VirgilCipher();
            cipher.addKeyRecipient(certId, keys.publicKey());
            var encryptedData = cipher.encrypt(data, true);
            var decryptedData = cipher.decryptWithKey(encryptedData, certId, keys.privateKey(), pwd);
            console.log(decryptedData.toUTF8());
            pwd.delete();
            keys.delete();
            certId.delete();
            data.delete();
            cipher.delete();
            encryptedData.delete();
            decryptedData.delete();
        };
        function test_sign() {
            var pwd = Module.VirgilByteArray.fromUTF8("");
            var keys = new Module.VirgilKeyPair(pwd);
            var certId = Module.VirgilByteArray.fromUTF8("17648c7e-9ca3-4707-bdc6-a5c57b7a18fc");
            var data = Module.VirgilByteArray.fromUTF8("data to be signed");
            var signer = new Module.VirgilSigner();
            var sign = signer.sign(data, keys.privateKey(), pwd);
            var verified = signer.verify(data, sign, keys.publicKey());
            console.log("Data verification " + (verified ? "passed" : "failed"));
            pwd.delete();
            keys.delete();
            certId.delete();
            data.delete();
            signer.delete();
            sign.delete();
        };
        var Module = {
            onRuntimeInitialized: function() {
                console.log(Module.VirgilVersion.asString())
            }
        };
    </script>
    <script async type="text/javascript" src="virgil_emscripten_@VIRGIL_VERSION@.js"></script>
</body>
</html>
